<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>English Introductions</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <script>
        const colorScheme = window.matchMedia('(prefers-color-scheme: dark)');

        function applyTheme(e) {
            const isDark = e.matches;
            if (isDark) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        colorScheme.addEventListener('change', applyTheme);
        // Initial application
        if (colorScheme.matches) document.documentElement.classList.add('dark');
    </script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        brand: '#4f46e5',
                        'brand-glow': '#818cf8',
                        surface: '#ffffff',
                    },
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'sans-serif'],
                    },
                    screens: {
                        'xs': '480px',
                    },
                }
            }
        }
    </script>

    <style>
        /* --- CSS VARIABLES & THEME CONFIGURATION --- */
        :root {
            /* Light Mode Variables */
            --bg-body: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --accent: #4f46e5;
            --border-ui: #e2e8f0;
            --sidebar-width: 280px;

            /* Glass Light */
            --glass-bg: rgba(255, 255, 255, 0.85);
            --glass-border: rgba(255, 255, 255, 0.5);
        }

        /* Dark Mode Overrides */
        html.dark {
            --bg-body: #0f172a;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --accent: #6366f1;
            --border-ui: #334155;

            /* Glass Dark */
            --glass-bg: rgba(15, 23, 42, 0.85);
            --glass-border: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background-color: var(--bg-body);
            color: var(--text-primary);
            overflow: hidden;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- COMPONENT STYLES --- */
        .glass-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-ui);
            box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05);
        }

        .slide-container {
            height: calc(100dvh - 140px);
            /* Adjust based on header/footer height */
            position: relative;
            overflow: hidden;
            background: var(--bg-body);
        }

        .slide {
            position: absolute;
            inset: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            pointer-events: none;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            transform: translateX(30px);
        }

        .slide.active {
            opacity: 1;
            pointer-events: auto;
            transform: translateX(0);
        }

        .slide.prev {
            transform: translateX(-30px);
        }

        .zoom-container {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Sidebar Styles */
        .sidebar-thumb {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
            background: var(--bg-card);
        }

        .sidebar-thumb:hover {
            border-color: var(--border-ui);
        }

        .sidebar-thumb.active {
            border-color: var(--accent);
            background: var(--bg-body);
        }

        .sidebar-thumb.active .thumb-number {
            background: var(--accent);
            color: white;
        }

        /* --- Sidebar Dark Mode Number Fix --- */
        html.dark .thumb-number {
            color: var(--text-primary);
            background: var(--bg-card);
            border-color: var(--border-ui);
        }

        html.dark .sidebar-thumb:hover .thumb-number {
            border-color: var(--accent);
        }

        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: transparent;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: var(--border-ui);
            border-radius: 10px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
            background: var(--bg-card);
            /* Match slide background */
        }

        .btn-action {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.6rem 1.25rem;
            border-radius: 0.85rem;
            font-weight: 800;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            user-select: none;
            white-space: nowrap;
            font-size: 0.75rem;
        }

        @media (min-width: 640px) {
            .btn-action {
                gap: 0.75rem;
                padding: 0.75rem 1.5rem;
                border-radius: 1rem;
                font-size: 0.85rem;
            }
        }

        .btn-action:active {
            transform: scale(0.95);
        }

        /* --- TEACHER CUE STYLING --- */
        .cue-btn {
            position: relative;
            overflow: hidden;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1.25rem;
            border-radius: 0.65rem;
            background: #4f46e5;
            color: white;
            font-weight: 800;
            font-size: 0.7rem;
            letter-spacing: 0.05em;
            text-transform: uppercase;
            box-shadow:
                0 0 0 1px rgba(79, 70, 229, 0.4),
                0 10px 20px -10px rgba(79, 70, 229, 0.5);
            transition: all 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            cursor: pointer;
            border: none;
        }

        @media (min-width: 640px) {
            .cue-btn {
                gap: 0.75rem;
                padding: 0.7rem 1.75rem;
                border-radius: 0.75rem;
                font-size: 0.9rem;
            }
        }

        .cue-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transform: translateX(-100%);
            transition: transform 0.6s ease;
        }

        .cue-btn:hover {
            box-shadow:
                0 0 0 2px rgba(79, 70, 229, 0.4),
                0 8px 16px -4px rgba(79, 70, 229, 0.3);
            background: #4338ca;
        }

        .cue-btn:hover::before {
            transform: translateX(100%);
        }

        .cue-icon-wrap {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 20px;
            height: 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            transition: all 0.3s ease;
        }

        @media (min-width: 640px) {
            .cue-icon-wrap {
                width: 24px;
                height: 24px;
            }
        }

        .cue-btn:hover .cue-icon-wrap {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
        }

        .cue-tooltip {
            position: absolute;
            top: calc(100% + 20px);
            left: 50%;
            transform: translateX(-50%) translateY(20px);
            width: 360px;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.96);
            backdrop-filter: blur(24px) saturate(200%);
            -webkit-backdrop-filter: blur(24px) saturate(200%);
            clip-path: polygon(0 0, 100% 0, 100% calc(100% - 30px), calc(100% - 30px) 100%, 0 100%);
            border: 1px solid rgba(79, 70, 229, 0.1);
            box-shadow:
                0 40px 80px -15px rgba(15, 23, 42, 0.15),
                inset 0 0 0 1px rgba(79, 70, 229, 0.05);
            color: #475569;
            text-align: left;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1);
            z-index: 100;
        }

        .cue-header {
            position: relative;
            background: rgba(79, 70, 229, 0.05);
            padding: 0.6rem 1.25rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
            border-left: 3px solid #4f46e5;
            overflow: hidden;
        }

        .cue-header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(to bottom, transparent, rgba(79, 70, 229, 0.1), transparent);
            animation: scanline 3s infinite linear;
        }

        @keyframes scanline {
            0% {
                transform: translateY(-100%);
            }

            100% {
                transform: translateY(100%);
            }
        }

        .cue-badge {
            font-size: 11px;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 0.2em;
            color: #4f46e5;
            text-shadow: 0 0 10px rgba(79, 70, 229, 0.2);
        }

        .cue-header .cue-badge {
            /* Adjusted to target the badge within the header */
            display: inline-flex;
            align-items: center;
            gap: 0.6rem;
        }

        .cue-header .cue-badge::after {
            /* Adjusted to target the badge within the header */
            content: '';
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #4f46e5;
            box-shadow: 0 0 8px rgba(79, 70, 229, 0.4);
        }

        .teacher-cue {
            margin-top: 0;
        }

        .teacher-cue div {
            margin-bottom: 0.75rem;
            display: flex;
            gap: 0.75rem;
            align-items: flex-start;
            font-size: 0.9rem;
            line-height: 1.5;
            color: #475569;
            padding: 0.25rem 0;
            cursor: default;
        }

        .cue-marker {
            flex-shrink: 0;
            width: 12px;
            height: 2px;
            background: #4f46e5;
            margin-top: 1rem;
            box-shadow: 0 0 8px rgba(79, 70, 229, 0.3);
            transition: all 0.3s ease;
        }

        .teacher-cue div:hover .cue-marker {
            width: 20px;
            background: #818cf8;
            box-shadow: 0 0 12px rgba(129, 140, 248, 0.6);
        }

        .teacher-cue span:not(.cue-marker) {
            font-size: 0.9rem;
            font-weight: 500;
            line-height: 1.8;
            color: #475569;
            transition: all 0.3s ease;
        }

        .teacher-cue div:hover span:not(.cue-marker) {
            color: #0f172a;
            transform: translateX(5px);
        }

        @keyframes edge-pulse {

            0%,
            100% {
                opacity: 0.2;
                filter: brightness(1);
            }

            50% {
                opacity: 0.6;
                filter: brightness(1.5);
            }
        }

        /* --- DARK MODE ADAPTATION --- */
        html.dark .cue-tooltip {
            background: rgba(15, 23, 42, 0.98);
            border-color: rgba(79, 70, 229, 0.2);
            box-shadow: 0 40px 80px -15px rgba(0, 0, 0, 0.6);
            color: #f8fafc;
        }

        html.dark .cue-header {
            background: rgba(79, 70, 229, 0.1);
            border-left-color: #6366f1;
        }

        html.dark .teacher-cue div,
        html.dark .teacher-cue span:not(.cue-marker),
        html.dark .cue-header {
            color: #ffffff;
        }

        html.dark .teacher-cue div:hover span:not(.cue-marker) {
            color: #ffffff;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
        }

        html.dark .cue-marker {
            background: #6366f1;
            box-shadow: 0 0 8px rgba(99, 102, 241, 0.4);
        }

        .group:hover .cue-tooltip {
            opacity: 1;
            visibility: visible;
            transform: translateX(-50%) translateY(0);
        }


        /* --- MOBILE SIDEBAR TRANSITION --- */
        #mobile-sidebar-overlay {
            transition: opacity 0.3s ease;
        }

        #sidebar-drawer {
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .translate-x-full {
            transform: translateX(100%);
        }

        .translate-x-0 {
            transform: translateX(0);
        }
    </style>
</head>

<body class="flex flex-col h-[100dvh]">

    <!-- Top Header -->
    <header class="h-[70px] px-4 md:px-8 flex items-center justify-between glass-panel z-50 shrink-0 relative">
        <!-- Section 1: Logo (Left) -->
        <div class="flex-1 flex items-center gap-2 md:gap-3">
            <div
                class="w-8 h-8 md:w-10 md:h-10 bg-gradient-to-tr from-brand to-indigo-600 rounded-xl flex items-center justify-center shadow-lg shadow-indigo-200 shrink-0">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 md:w-6 md:h-6 text-white" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2.5">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
            </div>
            <div class="hidden xs:block">
                <h1
                    class="text-[10px] md:text-lg font-extrabold tracking-tight leading-tight max-w-[100px] md:max-w-none">
                    English Introductions</h1>
            </div>
        </div>

        <!-- Section 2: Teacher Cue (Center) -->
        <div class="flex-none flex items-center justify-center">
            <div class="group relative">
                <button id="cue-toggle-btn" class="cue-btn !px-3 !py-1.5 md:!px-5 md:!py-2">
                    <span class="text-[10px] md:text-[14px]">Teacher Cue</span>
                    <div class="cue-icon-wrap !w-4 !h-4 md:!w-6 md:!h-6">
                        <svg xmlns="http://www.w3.org/2000/svg" class="w-3 h-3 md:w-4 md:h-4" viewBox="0 0 16 16">
                            <g fill="currentColor">
                                <path
                                    d="M9 11a1 1 0 1 1-2 0a1 1 0 0 1 2 0M7.5 4A2.5 2.5 0 0 0 5 6.5h2a.5.5 0 0 1 .5-.5h.646a.382.382 0 0 1 .17.724L7 7.382V9h2v-.382l.211-.106A2.382 2.382 0 0 0 8.146 4z" />
                                <path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-6a6 6 0 1 0 0 12A6 6 0 0 0 8 2" />
                            </g>
                        </svg>
                    </div>
                </button>

                <!-- Tooltip -->
                <div id="cue-tooltip" class="cue-tooltip">
                    <div class="cue-header">Instructional Insight</div>
                    <div class="teacher-cue"></div>
                </div>
            </div>
        </div>

        <!-- Section 3: Controls (Right) -->
        <div class="flex-1 flex items-center justify-end gap-2 md:gap-4">
            <!-- Fullscreen Button -->
            <button onclick="toggleFullscreen()"
                class="hidden sm:block p-2 rounded-xl border border-[var(--border-ui)] hover:bg-slate-50 dark:hover:bg-slate-800 transition-colors text-slate-600 dark:text-slate-300">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4" />
                </svg>
            </button>

            <!-- Burger Menu Button (Right on mobile) -->
            <button id="mobile-menu-btn"
                class="lg:hidden p-2 rounded-lg hover:bg-slate-100 dark:hover:bg-slate-800 transition-colors text-brand dark:text-brand-glow">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5"
                        d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
        </div>
    </header>

    <div class="flex flex-1 relative overflow-hidden">
        <!-- Main Content Area -->
        <main class="flex-1 slide-container w-full">
            <div id="zoom-wrapper" class="zoom-container">
                <div id="slides-wrapper" class="w-full h-full relative">
                    <template id="slide-template">
                        <div class="slide">
                            <div class="w-full h-full flex items-center justify-center">
                                <!-- Iframe src will be set via JS -->
                                <iframe src="" loading="lazy"></iframe>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </main>

        <!-- Mobile Sidebar Overlay -->
        <div id="mobile-sidebar-overlay"
            class="fixed inset-0 bg-black/50 z-[60] lg:hidden opacity-0 pointer-events-none backdrop-blur-sm"></div>

        <!-- Right Side Navigation Sidebar -->
        <!-- Fixed on mobile, static on desktop -->
        <aside id="sidebar-drawer"
            class="fixed lg:static inset-y-0 right-0 z-[70] w-[85%] max-w-[320px] bg-[var(--bg-card)] border-l border-[var(--border-ui)] flex flex-col translate-x-full lg:translate-x-0 shadow-2xl lg:shadow-none h-full">

            <div class="flex items-center justify-between p-5 border-b border-[var(--border-ui)]">
                <div class="flex flex-col gap-1">

                    <h3 class="font-black text-xs uppercase tracking-[0.2em] text-[var(--text-secondary)]">Course
                        Content</h3>
                    <p class="text-sm md:text-md font-bold text-[var(--text-primary)]">Slide Navigation</p>
                </div>
                <!-- Mobile Close Button -->
                <button id="close-sidebar-btn"
                    class="lg:hidden p-2 rounded-full hover:bg-slate-100 dark:hover:bg-slate-800 text-[var(--text-secondary)]">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>

            <div id="sidebar-list" class="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-3">
                <!-- Sidebar items injected via JS -->
            </div>
        </aside>
    </div>

    <!-- Bottom Control Bar -->
    <footer class="h-[70px] glass-panel flex items-center justify-between px-3 md:px-8 z-50 border-t shrink-0">
        <div class="flex items-center gap-2 md:gap-4 flex-1">
            <button onclick="prevSlide()"
                class="btn-action bg-[var(--bg-card)] border border-[var(--border-ui)] text-[var(--text-primary)] hover:border-brand hover:text-brand shadow-sm !px-3 md:!px-5">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M15 19l-7-7 7-7" />
                </svg>
                <span class="text-[10px] md:text-[11px] uppercase tracking-[0.1em] hidden sm:inline">Previous</span>
            </button>

            <div class="h-8 w-px bg-[var(--border-ui)] hidden md:block"></div>

            <div
                class="flex items-center gap-1.5 md:gap-2 bg-[var(--bg-body)] px-2 py-1 md:px-3 md:py-1.5 rounded-xl border border-[var(--border-ui)]">
                <button onclick="changeZoom(-0.1)"
                    class="p-1 text-[var(--text-secondary)] hover:text-brand transition-colors"><svg class="w-4 h-4"
                        fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M20 12H4" />
                    </svg></button>
                <span id="zoom-level"
                    class="text-[9px] md:text-[10px] font-black min-w-[2.2rem] md:min-w-[2.5rem] text-center uppercase text-[var(--text-primary)]">100%</span>
                <button onclick="changeZoom(0.1)"
                    class="p-1 text-[var(--text-secondary)] hover:text-brand transition-colors"><svg class="w-4 h-4"
                        fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4" />
                    </svg></button>
            </div>
        </div>

        <div class="flex items-center justify-end gap-2 md:gap-4 flex-1">
            <span id="slide-index-footer"
                class="text-[9px] md:text-[11px] font-black tracking-[0.1em] text-[var(--text-secondary)] bg-[var(--bg-body)] px-2.5 md:px-4 py-2 rounded-xl border border-[var(--border-ui)]">01
                / 12</span>
            <button onclick="nextSlide()"
                class="btn-action bg-brand text-white shadow-lg shadow-brand/20 hover:bg-brand-glow !px-3 md:!px-5">
                <span class="text-[10px] md:text-[11px] uppercase tracking-[0.1em] hidden sm:inline">Next Slide</span>
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M9 5l7 7-7 7" />
                </svg>
            </button>
        </div>
    </footer>

    <script>
        const slideData = [
            { title: "Introduction", src: "./slides/slide1.html", cue: ["Introduce the topic: 'Hello! Let's Introduce Ourselves'"] },
            { title: "Warm-up Spin", src: "./slides/slide2.html", cue: ["Use the wheel to ask warm-up questions.", "Click 'Spin' to select a question."] },
            { title: "Objectives", src: "./slides/slide3.html", cue: ["Review the learning objectives.", "Play audio for pronunciation."] },
            { title: "Video", src: "./slides/slide4.html", cue: ["Watch the video about introductions.", "Repeat the phrases after the video."] },
            { title: "Speaking Practice", src: "./slides/slide5.html", cue: ["Practice the dialogue: 'What's your job?'", "Fill in the blanks."] },
            { title: "Jobs Vocabulary 1", src: "./slides/slide6.html", cue: ["Learn the first set of job titles.", "Listen to the audio for each job."] },
            { title: "Jobs Vocabulary 2", src: "./slides/slide7.html", cue: ["Learn the second set of job titles.", "Listen to the audio."] },
            { title: "Extended Vocab", src: "./slides/slide8.html", cue: ["Explore more job titles categorized by sector.", "Match vocabulary."] },
            { title: "Greetings Chart", src: "./slides/slide9.html", cue: ["Review Formal vs Informal greetings.", "Listen to the differences."] },
            { title: "Reading: Sort", src: "./slides/slide10.html", cue: ["Drag greetings to the correct category.", "Is it Formal or Informal?"] },
            { title: "Speaking Challenge", src: "./slides/slide11.html", cue: ["Ask student to introduce themselves.", "Use the prompt for guidance."] },
            { title: "Homework", src: "./slides/slide12.html", cue: ["Assign the spin wheel activity.", "Explain the Padlet link."] }
        ];

        const state = {
            currentSlide: 0,
            zoom: 1.0,
            slides: [],
            loadedSlides: new Set()
        };

        // --- RESPONSIVE SIDEBAR LOGIC ---
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const closeSidebarBtn = document.getElementById('close-sidebar-btn');
        const sidebarDrawer = document.getElementById('sidebar-drawer');
        const sidebarOverlay = document.getElementById('mobile-sidebar-overlay');

        function toggleSidebar(show) {
            if (show) {
                sidebarDrawer.classList.remove('translate-x-full');
                sidebarDrawer.classList.add('translate-x-0');
                sidebarOverlay.classList.remove('opacity-0', 'pointer-events-none');
            } else {
                sidebarDrawer.classList.add('translate-x-full');
                sidebarDrawer.classList.remove('translate-x-0');
                sidebarOverlay.classList.add('opacity-0', 'pointer-events-none');
            }
        }

        mobileMenuBtn.addEventListener('click', () => toggleSidebar(true));
        closeSidebarBtn.addEventListener('click', () => toggleSidebar(false));
        sidebarOverlay.addEventListener('click', () => toggleSidebar(false));

        // --- TEACHER CUE TOGGLE ---
        const cueToggleBtn = document.getElementById('cue-toggle-btn');
        const cueTooltip = document.getElementById('cue-tooltip');

        function toggleCue(e) {
            e.stopPropagation();
            const group = e.currentTarget.closest('.group');
            const targetTooltip = group.querySelector('.cue-tooltip');

            const isVisible = targetTooltip.style.opacity === '1';

            if (isVisible) {
                targetTooltip.style.opacity = '0';
                targetTooltip.style.visibility = 'hidden';
                targetTooltip.style.transform = 'translateX(-50%) translateY(20px)';
            } else {
                targetTooltip.style.opacity = '1';
                targetTooltip.style.visibility = 'visible';
                targetTooltip.style.transform = 'translateX(-50%) translateY(0)';
            }
        }

        if (cueToggleBtn) cueToggleBtn.addEventListener('click', toggleCue);

        document.addEventListener('click', (e) => {
            if (cueTooltip && !cueTooltip.contains(e.target) && e.target !== cueToggleBtn && !cueToggleBtn?.contains(e.target)) {
                cueTooltip.style.opacity = '0';
                cueTooltip.style.visibility = 'hidden';
                cueTooltip.style.transform = 'translateX(-50%) translateY(20px)';
            }
        });

        // --- SLIDE LOGIC ---
        function init() {
            createSlides();
            createSidebar();
            updateSlides();

            window.addEventListener('keydown', (e) => {
                if (e.key === 'ArrowRight') nextSlide();
                if (e.key === 'ArrowLeft') prevSlide();
            });
        }

        function createSlides() {
            const wrapper = document.getElementById('slides-wrapper');
            const template = document.getElementById('slide-template');

            slideData.forEach((data, i) => {
                const clone = template.content.cloneNode(true);
                const slide = clone.querySelector('.slide');
                const iframe = slide.querySelector('iframe');

                // Sync theme when iframe loads
                iframe.onload = () => {
                    const isDark = document.documentElement.classList.contains('dark');
                    if (iframe.contentWindow && typeof iframe.contentWindow.setTheme === 'function') {
                        iframe.contentWindow.setTheme(isDark ? 'dark' : 'light');
                    }
                };

                wrapper.appendChild(clone);
            });
            state.slides = document.querySelectorAll('.slide');
        }

        function createSidebar() {
            const sidebarList = document.getElementById('sidebar-list');
            slideData.forEach((data, i) => {
                const item = document.createElement('div');
                item.className = `sidebar-thumb flex items-center gap-4 p-3 rounded-2xl group border border-transparent active:scale-95 transition-all`;
                item.onclick = () => goToSlide(i);
                item.innerHTML = `
                    <div class="thumb-number w-8 h-8 rounded-lg bg-slate-50 border border-[var(--border-ui)] flex items-center justify-center text-[10px] font-black group-hover:border-brand transition-colors text-[var(--text-primary)]">
                        ${String(i + 1).padStart(2, '0')}
                    </div>
                    <div class="overflow-hidden">
                        <p class="text-[10px] font-black uppercase tracking-wider text-[var(--text-secondary)]">Slide ${i + 1}</p>
                        <p class="title text-sm md:text-md font-bold leading-tight text-[var(--text-primary)] truncate">${data.title}</p>
                    </div>
                `;
                sidebarList.appendChild(item);
            });
        }

        function updateHeaderInfo() {
            // Optional header info update if needed
        }

        function updateSlides() {
            state.slides.forEach((s, i) => {
                // 1. Handle CSS Transitions
                s.classList.toggle('active', i === state.currentSlide);
                s.classList.toggle('prev', i < state.currentSlide);
                s.classList.toggle('next', i > state.currentSlide);

                // 2. LAZY LOADING / AJAX LOGIC
                if (i === state.currentSlide && !state.loadedSlides.has(i)) {
                    const iframe = s.querySelector('iframe');
                    const src = slideData[i].src;

                    // Only load if src exists and is not empty
                    if (src && src.trim() !== "") {
                        iframe.src = src;
                        state.loadedSlides.add(i);
                    }
                }
            });

            const thumbs = document.querySelectorAll('.sidebar-thumb');
            thumbs.forEach((t, i) => t.classList.toggle('active', i === state.currentSlide));

            const activeThumb = thumbs[state.currentSlide];
            if (activeThumb) activeThumb.scrollIntoView({ behavior: 'smooth', block: 'nearest' });

            // Trigger reset/replay for slides that support it
            const activeSlide = state.slides[state.currentSlide];
            if (activeSlide) {
                const iframe = activeSlide.querySelector('iframe');
                if (iframe && iframe.contentWindow && typeof iframe.contentWindow.resetSlide === 'function') {
                    setTimeout(() => {
                        try {
                            iframe.contentWindow.resetSlide();
                        } catch (e) { console.log("Reset slide not ready or failed"); }
                    }, 100);
                }
            }

            const cues = slideData[state.currentSlide].cue || [];
            const cueHtml = cues.map(c => `
                <div>
                    <span class="cue-marker"></span>
                    <span>${c}</span>
                </div>
            `).join('');

            document.querySelectorAll('.teacher-cue').forEach(el => {
                el.innerHTML = cueHtml;
            });

            // Update loop for cues could go here if needed
            document.getElementById('slide-index-footer').textContent = `${String(state.currentSlide + 1).padStart(2, '0')} / ${String(state.slides.length).padStart(2, '0')}`;
            updateHeaderInfo();
        }

        function stopAllIframeAudio() {
            const activeSlide = state.slides[state.currentSlide];
            if (activeSlide) {
                const iframe = activeSlide.querySelector('iframe');
                try {
                    if (iframe && iframe.contentWindow && typeof iframe.contentWindow.stopSlideAudio === 'function') {
                        iframe.contentWindow.stopSlideAudio();
                    }
                } catch (e) {
                    console.warn("Could not stop iframe audio:", e);
                }
            }
        }

        function nextSlide() {
            if (state.currentSlide < state.slides.length - 1) {
                stopAllIframeAudio();
                state.currentSlide++;
                updateSlides();
            }
        }
        function prevSlide() {
            if (state.currentSlide > 0) {
                stopAllIframeAudio();
                state.currentSlide--;
                updateSlides();
            }
        }
        function goToSlide(index) {
            stopAllIframeAudio();
            state.currentSlide = index;
            updateSlides();
        }

        function changeZoom(delta) {
            state.zoom = Math.min(Math.max(0.5, state.zoom + delta), 2.0);
            document.getElementById('zoom-wrapper').style.transform = `scale(${state.zoom})`;
            document.getElementById('zoom-level').textContent = `${Math.round(state.zoom * 100)}%`;
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else if (document.exitFullscreen) document.exitFullscreen();
        }

        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>